function playJourney() {

    var journey =
        {
            "Id": "19b9c1b8-7982-fad3-4646-0e22daa33ea4",
            "Title": "Untitled journey",
            "Stops": [
                {
                    "Name": "Seattle, WA, United States",
                    "Notes": "Sold our stuff and started driving!",
                    "Location": {
                        "lat": 47.6062095,
                        "lng": -122.3320708
                    },
                    "PlaceId": "ChIJVTPokywQkFQRmtVEaUZlJRA",
                    "Mode": "DRIVING",
                    "Photo": "https://lh3.googleusercontent.com/tY8qZTr2fp-oD1peMhdN-WNrJQ3FQjNKMD0Ozb9Oiu7Lxfsjkn0SdQvP5dBmVnDSigb_CGNSGRguheBTq69hqJv34diwP23Kv6mqdPtfALxLI8uyqFtZneVZf4_XwWJ6LaJruNYHo6v9kY183ynysOmwXdkrWhtKEknpj9py4myHNMvC4ubeksm2GoZ1IZb95Rag4FwKaLt4aH5nvqN0xciRAKwSaYvjeT8KogJ8sDwkGsvxJfQFX3_R2ym6QuqCmU-4jLoMg_hKFLLtAIGI7lDggFgN_5hYbhjUgnPUx3bTvGObjZxiEIYGEjmYfxAW6ILCMz-qJhdcNLi7so4OcBeBqfC1PyW4hISh0FrymWSNcDSQlVrRZUJupK9nsyd0eI8vXssAydaMtgg7uB1K7sL3-TppaibdwIKQbRBxtgDZCsWkE_iaFxPsmUh0bSJwJRxxs03PB-Iy2WhrRzbQj0eVMQ58SDQVvH7qBIHjCC2bH7G-6cZGEYxmxSzL6AmtVT446xHDdsyIq0WkfU-BqTHnoq-t9gqvxQ0Bs_EuvZCbfN0U68l5QLSGyyH_01UGiwsBiTFMr1c1--_b2xAXIKhqB3szJAk08QSgfcWmPpNd5Wzj=w1766-h945-no"
                },
                {
                    "Name": "Kansas City, KS, United States",
                    "Notes": "Obligatory family visit!",
                    "Location": {
                        "lat": 39.11405299999999,
                        "lng": -94.6274636
                    },
                    "PlaceId": "ChIJFTXPJ-SMwIcRBR7DcHt3d9w",
                    "Mode": "DRIVING",
                    "Poly": "ybqaHj_tiV`nDste@rcMybm@rgA_|O`aE{zRh_Hu_W`_By~Zq~BypEvcEu`D`nJaqF|nH}nKxwKon[x~Cai_@hbEinTlzR}wa@ljOmjXdXox\\ncCk`YblAkfm@mj@wfLm`Gxf@csJoyIyeJcdPiC{fqA`gBikw@qrCkfcCao@cvMsjIuzMgtLqs^gvJquW{}{@qp}AulJekj@v@gtb@m|Fko`@f\\ajOveFmbShcHcnOjAegYtcNs}c@vaB}mp@vvI{n^pnA{gRfMqbTdxCwoKdvBezPdhCizWvaJc|_@vgDyzJdvGop\\lxDuqDjR}rFd}FqsQbkJ}qQb_I_|Bb_MmbJ}j@oxLqFgkVn{C_oNeoD{vKaZqnQvzP}|e@zjLwt[uOyfKttMcwXlkLq{MvpB_a`@|Umd`@zq@{fXhiM_kZt_Lawe@bhGu_NfsBivJxfSgtAntWvfEf_OvjEbmTfHbcH_xIlgCss\\xmFkdSteGwcE~{AqhYbaFakhA}~Eg|[eC{hm@|xHcrd@jfUyil@jyLg|TriDm{ZorAoak@n~AoaQi|KcbUxvBow_@{wFqlFcmRab_AvsR_t^~qCky[bGq{OxnBeePz{Eye]h`Jukc@usG}|d@mnFe``@idM_ug@oaMg_TttDuiVniBe{Z|hAswh@ncC{~_AraLiyOnyOgnGrfJoxb@zl@kia@_Gc~TsgFkkOwqFqeR{{Dwel@vsCkxi@|gEcwWtp@y|c@jvMkggAr}Hk}n@doJckQb|Qmjr@xsYcobAft]aieAh_NwoRd{k@imlAnrJwgEbfJoxKb`OkqSzeJamO~fPulXfnZqgQ|tLqzLfvDszKysAwp_@byAqmiAh@y_Y`aDw|J|kAwaSzvGc`N~mEibOfmJ{}Ln`Qmfx@ygAqbaBwEmhYcxH{`UjlAiht@dGs}ZgqCysWx_AofuAtLico@zpFicv@hgMgfp@~dEaj^l|Aqtw@ryDmmjApsBu~yBbxCqlNlA{oq@_M{ak@vJknc@rzIkzPoKgrp@bbIxn@dbZtjB`{aAwBvwv@qDxaTclRxk[qbe@z{GosD~YcyKr{RerGj}]{mVxyQqxE|cWulP|m[s}ArdGiyDlu]qzFl_SkoU|}\\aoBnbWsaEjxCvtFfvD{nKh`Gg}BhvP~n@j{RedDbcs@`nAxaPy|M|}JoyPbwWk}K|bYkdPv`TqnUzkIs~RdzNkhMngd@mlbAtoE_lIf~OgwAjc|@}VfcPohB|eDkvE`|Eu|Hf|KimD|bNmnExhHfL",
                    "Photo": "https://lh3.googleusercontent.com/U1GTuHy5w1R8IdN5-sYsIhdwezKu-Y7VJzZUk7cp4fPB9UCZkztlV9Tefivq0p8-IZihwuPJg9JmwKwmFnPfTnF0TLb7LHCmUvz3jRtUtucX1SFBMzXm_vrqRa5xg-eTo9zv5y1F0t2mdNSuewcHBx12xRLHehQ2a49tob05C0MlwKxF-Rh6pALX2dcnjap1okLgee4N-RVk9tIPDSt047Kp_Bnnx4zEv6uEjeNtvXaWRLKevrgpvC2Ip61Xu0klh80lnsu-bxnMIi3ArQ430ODEbJmypmgSoB1B8S2xmR1C9ymKGCea40pcTdDcHsLKBjuUOZJfHmj_DvyUHOUksEwjDrDcEYcT93v20K50KuaGDgAkCWD5AIGN1QTmT9CpPG9DA071BvIeBPIhmQPgMq9L3dpPddHQONiD7rtDgSAhwmrINY-zda-ZeMpfuX9evSOLrBpQ3YZMBulXOABuxkhB3_AtmPtX42vCfDkcAjYAt9lVv5F0xB3iyazSXxRti16CO4vWevivGZqjbRQPFfml2cW1QAcNbIFz1TwBfYMhst9BWNxOQzcnpnCUeBieap5ZEtl51WWGkNIJRuy3ilKvOa6keIQ5u5UuZF0tTnwpxSls=w1680-h945-no"
                },
                {
                    "Name": "Chicago, IL, United States",
                    "Notes": "Took a train to the Windy City",
                    "Location": {
                        "lat": 41.8781136,
                        "lng": -87.62979819999998
                    },
                    "PlaceId": "ChIJ7cv00DwsDogRAMDACa2m4K8",
                    "Mode": "DRIVING",
                    "Poly": "ckvmFt|p`QiHuv@lLcXnb@ciApBm}Bu@{qAkiAa]utBtQ{j@_d@sgB_Kw_Ak^}OwuBodB{aC_vAyeBsTqfAw{B}xBuxC_hBmjAwVitAmwCybB_aA_bNmbG}uMgbGatNqqHuqMudD}aWofEaf@{[ghAoRaKoYg@_gANap@cVkUcR}Kv@ygAfAm|A~Ey}GjSkjKn{@spBjX}kAyDkiHsDgrXoV{|^xKijGyCar@wnAa}@mnCucE[_~GsVa_c@_H{dg@yH{oFzn@uxDry@qbIhXoy[iB_pMk`@mlGxcAmv[ig@ayG~v@}tF|Og~B_Eg{Dca@e`BrEoaG|UypXwJodFzcA{xAd{B{aOpqCetSt@c}Bxf@k~@vfBumKhp@g}Hui@w~B`H{uDpl@yaAvj@slOki@ygDnEc|DmYc}E}hBonCyRinKc\\ocCmP{}HdOytD{wAweCag@gxByFeyIo`@alDohBkwHsu@ii@ii@o^ht@eiDpbCisGr[}vGyeCeqGdQmy@vm@}Y|dB_|BsRunEntA_cF`_Aq`IdGexHrZqlGrf@gkBdl@yiBhSsbEyWmuGa_@sgPqj@ocHkc@}{Cf`@qaDr`@ipM`Deek@eCalDea@}fEeI}hD_|CefDkvCm{DrByfQ{Tmo]sD}rLuw@ixCyAa|Ljw@wlEnEgxDoLk~D}l@arCak@a{@inDug@arCcf@u~CGwbHhSoaDuDy}@ioAirDczCst@g@a`B}iCgjDklDuoAcp@e_AgV}\\aaAea@q}@o~CsgCmaBky@o_AknAotC_`B}uL{Gm[av@kA}fD_QirHcLmrBsoBs{A}}GkaJuUmsAieAajAknAcUcdD_iEii@i}Ait@ca@kdCq~BguAg_D{mCsmBcnB_nCmPy|@mfBefA{tCuaD}hAiFukBvr@{mGiN_uCqPyWws@bDmtKgLqeBkgB}~CkaCmhBqbAw|DwqDmfGevDepAev@uk@g]uyCapE_oCy`Dk`B__Cm@ygAiUihDg{CicCgw@o_Eq`Bm|CkqAcgH{FecImlRgqDgdDsbBub@iiB_h@sUsn@qn@gdCgeDwdDozBujCccDg[gs@aVcVqj@us@suGkrEqpGw{CqiD}gAoWwwAaiBovF}qHwlDkdA{pBurAalBgxDkt@ks@ukQvQi`Qj[{cCkiA_eBuf@swDfDkkAshAov@ad@quFLyr@gt@_wAgeDkiGmdOkbE}gKg{BqkHyaAavCcLulBm^koGokDkmDmwD{zQikC{pM{F{qB}u@sFylCiA",
                    "Photo": "https://lh3.googleusercontent.com/1QjNa4iXlvNB-zAHIZC_l1iXWnspR3W1-u2uO-tIjkvHcjRLCxVFiGP3O5Zl1CFdIrDZAv_YMzTJCsJlUem0lxDFcIqBSeFSUHbAY3a43RlicvPPhDxVu_tEVdzP9btp5D1XWyZU4EYkS36e-tssw9pr1AgA2Cz4FRf_B8DHGkIKaUFoe7m2un2J2yFxSzW3iUjgwBBHtFpyDzLDTfmEROprx3G74SHIszZ0C-NUURZO2qgyiOm1haNnfirxvPDHRwsdHDXXQnoRcvGc3FU56RS-DR7JbmNpvxvQ2yfm4qDVgrLqIfRZugSqrMlrAjdSwkKRFwbq1l5Po0zRgsXPv3KuslCoPLNKUoCZLzC_KctBXwsv8OirwpU2vpSa-UwdNnz3MD3cSY95N9xgZqkKazHDLXhFzskj_btePWcOnUZfzo6s4OuzWg1Nwd_N8tExILTbjKVm4-rgEZueZepmX5VqCzS6WU9F3myaC9Eb2vBJ_ePrtHYIHE-1D49md7v5Z3RkTuNBjnIEKnlyytiACANaw5WWZnq6NxgToX7VShpffZIUW3Xw2kX5ThgoyIh9TlxgeTqncv43NediGoobitQ2s2EyrHw6igor4IF7kmvxNbZm8Q=w1260-h945-no"
                },
                {
                    "Name": "Copenhagen, Denmark",
                    "Notes": "See some more friends in Copenhagen",
                    "Location": {
                        "lat": 55.6760968,
                        "lng": 12.568337100000008
                    },
                    "PlaceId": "ChIJIz2AXDxTUkYRuGeU5t1-3QQ",
                    "Mode": "OTHER",
                    "Poly": "eir~FfezuOm|esAk}pbR",
                    "Photo": "https://lh3.googleusercontent.com/jhOTxd-7d6YoI4RRSWiopVxZrahxKXoZoJOfvMg8Vg7fDKwcOcWm4w-OAK464zFktEe58ftzd_ZygU18Yg-yf1hQjUiH2BqB62P6a8pBU0Q-y-TbPHOCACDFfgQZK0tNwad--U9kO0EN97Xwhzwgy7jnWgUzp9qGBfHxbXsZITfiSn8I2p2I8lWuC-3Aw6l8tUww2z1BMRb9MKryCideJ2bFxBV3Zafg82P7LS8ZYvJ57tJOZrPDRXQAmUKv92KZG2E52k8JVETkI6P1Lumt60IhJsdme_V0Jr-MbEOaEnOXLT2QtnNDp023LLwpjJkmcZG912VIzvYSeqFydJRssxnknGme1VftAwq129V86lGVmVJA_wkCC8VYhyOyOD8HwCXqojQxgvnmOhkBWK2vdXCxlwXSnjJt5BUmISkamfzDu6R2h0khSaUoPbOc1EuP2A1exCwS6k_MIWb2lbLf0q9CwuIVSmTMfAtdIwPRY0iQO8uUsL3_vmqGlV7dbYFyLcdkA4TPLO_qPsZeOX7cFc63mw2jdR-UaKEY9OSnfs7C45YE88nYxG2Tp2sT1sdgwdLiiFepoden49jSMGj_o_gfU__ciriwtD8pVS9g4BcrLa4b=w1680-h945-no"
                },
                {
                    "Name": "Bucharest, Romania",
                    "Notes": "More family time in Romania",
                    "Location": {
                        "lat": 44.4267674,
                        "lng": 26.102538399999958
                    },
                    "PlaceId": "ChIJT608vzr5sUARKKacfOMyBqw",
                    "Mode": "OTHER",
                    "Poly": "sfyrIcwukAhctcAwkrqA",
                    "Photo": "http://www.destination360.com/europe/romania/images/s/bucharest.jpg"
                },
                {
                    "Name": "Istanbul, Ä°stanbul, Turkey",
                    "Notes": "Spent a week in this amazing city",
                    "Location": {
                        "lat": 41.0082376,
                        "lng": 28.97835889999999
                    },
                    "PlaceId": "ChIJawhoAASnyhQR0LABvJj-zOE",
                    "Mode": "OTHER",
                    "Poly": "ibdnG{ci~CxtzS{tpP",
                    "Photo": "https://lh3.googleusercontent.com/4yzYeqmx1ogU8OiW4wQPy1hfnUHODJQwr_Le3v7DMqfc27byLcBiQisjphsXZH427kIJE_fhalZKYdt5Tyg45ceQM9iYjEl1Daw6g-LQt2nJCk13EyJe8XSibUkjVR-jvKvbg46fPSigefkRxUB0tA7BlOOtzmvd0JDHQva8g3g0XU25Y0VxemX8rxHqyNyemnYKvp3UKoWviK4Cxxx5rRzJD9w2vX0bxyFbwkYkQ6VE09f4nZCEgt0wS4eBMqHsMJcExwos_IkdOwq6Kg1mkQKTjnuxnHrb8XsPKsFEEUhdIPs0l7twryLm9HaxKXpWPqLXnJNBCP9oaGpZDMZ2jRbmqLCRrxKiR6Pcul4fdsxWc_llTgMQ5Z9nNrSxMKFPM-pciQDEPHZ62vIECv29JcaNPnvmQoB1vrXQGlxJIiCzRN_CbH1Td_YyvP29hN6GomfX4oM5FqgJYRWjkDabS1Foq2PS09eyfHNf0VPwT9IJ5X33__OuLsqNUH9jz5PLxU9BUeFMaA-hrjwYKGRwa4oq59ZnkTZdN6t52cs8-fR_7a1qJW1besXzTXbQE9mGxCFeoV4xmMRkx-9YhLmJpIuCP3zs7kg-UiLMJwkcrPuG1UbaTA=s945-no"
                },
                {
                    "Name": "Kuala Lumpur Federal Territory of Kuala Lumpur Malaysia",
                    "Notes": "We're in South-East Asia! It's hot and humid!!",
                    "Location": {
                        "lat": 3.139003,
                        "lng": 101.68685499999992
                    },
                    "PlaceId": "ChIJ5-rvAcdJzDERfSgcL1uO2fQ",
                    "Mode": "OTHER",
                    "Poly": "olhyFwyzoDvicfFa{wzL",
                    "Photo": "https://lh3.googleusercontent.com/4ZUkKyQX0PHKyVJ-Y1hiLNOroMeBz0oMCv1wB9BOFDCG4SQNo3ieqQKrFseBVqiIyqiG_LDGC52FqBioWbODYvqXXkZepix-hf1ICCVZj242y8oAvm92o40oXCmwkhIKkr3OurjqzCQD-Ta9IMqD4_1rd9XUmtpEPrZbuNHkA9PpIPrMWitNwxxCG3ivCuTw7m6MnXlrhgnYGqC-W33SQ18ZouwleUXb2nIFCpfa4UC811Df9HPxsYIJY7YAcJ0GKAZdVaNB7e_6G-e6P3hppRcwDE-PpoEmx8Y3Quzdiay1nYwoFXXim4Ky0dj6pMvVYG5dCH1yrWvVulVMmBXkcYVvgsl_43KmSWv5IUkvBWmfBE4tbB8OVaFfdXRxpxJrEzdPYwrhquNpvddoBH72jWSpnn653dskww7PLfcFC0ZyU4MYhCaR7rx1Ay1mV6IPbvNmOcpyjhqIj_3tXWP8xhM09HLPDBFXlxOH2H5v3W75CwPLO5nl3LgE3eUfnljxu9kFW639DK6HHCT3Mv4qwY_iQny-PHqy1xct9ykf3qEuIDEDgrZ0ZO9PbuwvvNr-iF1tGw5_z6p6GPMT3cnf2o0kphCuzjxT1gnQ3_i_GeRjqWbNRw=s945-no"
                }
            ]
        };

    var map = null;
    var placesService = null;

    var prevMarker = null;
    var prevInfoWindow = null;
    var prevFlyLine = null;

    init();

    function init() {
        var mapDiv = document.getElementById('map');
        map = new google.maps.Map(mapDiv, {
            center: { lat: 0, lng: 0 },
            zoom: 2,
            disableDefaultUI: true,
            styles: [
                {
                    featureType: 'all',
                    stylers: [
                        { saturation: -30 }
                    ]
                }, {
                    featureType: 'poi',
                    stylers: [
                        { visibility: 'off' }
                    ]
                }, {
                    featureType: 'administrative.land_parcel',
                    stylers: [
                        { visibility: 'off' }
                    ]
                }, {
                    featureType: 'administrative.province',
                    stylers: [
                        { visibility: 'off' }
                    ]
                }, {
                    featureType: 'transit',
                    stylers: [
                        { visibility: 'off' }
                    ]
                }
            ]
        });

        placesService = new google.maps.places.PlacesService(map);
        playJourney();
    }

    function playJourney() {

        var points = [];
        var zooms = [];

        var SPEED = 1;
        var ZOOM_MS = 100;
        var BRINGINTOVIEW_MS = 120;
        var ADDMARKER_MS = 150;
        var DIRECTIONS_MS = 200;
        var NEXT_MS = 2000;

        var totalTime = NEXT_MS * SPEED * (journey.Stops.length + 1);

        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer({
            draggable: false,
            hideRouteList: true,
            preserveViewport: true,
            markerOptions: {
                visible: false
            }
        });
        directionsDisplay.setMap(map);

        init();
        play(0);

        // initializes our points array; calculates distances between points
        function init() {
            for (var i = 0; i < journey.Stops.length; i++) {
                var distance = 0;

                var currentLat = journey.Stops[i].Location.lat;
                var currentLon = journey.Stops[i].Location.lng;
                var latLng = new google.maps.LatLng(currentLat, currentLon);
                var currentName = journey.Stops[i].Name;
                var currentNotes = journey.Stops[i].Notes;

                if (i > 0) {
                    var prevLat = journey.Stops[i - 1].Location.lat;
                    var prevLon = journey.Stops[i - 1].Location.lng;
                    var prevLatLng = new google.maps.LatLng(prevLat, prevLon);
                    distance = getDistanceBetweenPoints(prevLat, prevLon, currentLat, currentLon);
                }
                var point = {
                    LatLng: latLng,
                    Name: currentName,
                    Notes: currentNotes,
                    Distance: distance,
                    Poly: journey.Stops[i].Poly,
                    Mode: journey.Stops[i].Mode,
                    Photo: journey.Stops[i].Photo
                };
                points.push(point);
            }
        }

        function play(currentPoint) {

            // main loop
            setTimeout(function () {

                if (currentPoint >= points.length) {
                    return;
                }

                var LatLng = points[currentPoint].LatLng;
                var currentName = points[currentPoint].Name;
                var currentNotes = points[currentPoint].Notes;
                var marker = null;

                if (currentPoint == 0) {

                    bringPointIntoView(LatLng);
                    setZoomToCoverPoints(0);

                } else {

                    var prevLatLng = points[currentPoint - 1].LatLng;
                    var distance = points[currentPoint].Distance;

                    // zoom in or out to show both the previos point and the current one    
                    setTimeout(function () {
                        setZoomToCoverPoints(distance);
                    }, SPEED * ZOOM_MS);

                    setTimeout(function () {
                        bringPointIntoView(LatLng);
                    }, SPEED * BRINGINTOVIEW_MS);

                    setTimeout(function () {
                        var driving = false;
                        if (points[currentPoint].Mode == "DRIVING") {
                            driving = true;
                        }

                        if (prevFlyLine) {
                            prevFlyLine.setMap(null);
                            prevFlyLine.setPath(null);
                        }

                        var path = google.maps.geometry.encoding.decodePath(points[currentPoint].Poly);
                        var geodesic = true;
                        if (driving) {
                            geodesic = false;
                        }
                        var flyLine = new google.maps.Polyline({
                            strokeColor: '#73b9ff',
                            strokeOpacity: 0.7,
                            strokeWeight: 6,
                            geodesic: geodesic,
                            map: map
                        });
                        flyLine.setPath(path);
                        prevFlyLine = flyLine;

                    }, SPEED * DIRECTIONS_MS);

                }

                // add the marker and the info window                                                                
                setTimeout(function () {

                    if (prevMarker) {
                        prevMarker.setMap(null);
                        var image = {
                            url: 'https://storage.googleapis.com/www.georgestrajan.com/1471984144_star.png',
                            size: new google.maps.Size(32, 32),
                            origin: new google.maps.Point(0, 0),
                            anchor: new google.maps.Point(8, 8),
                            scaledSize: new google.maps.Size(16, 16)
                        };
                        var visitedMarker = new google.maps.Marker({
                            position: prevLatLng,
                            map: map,
                            icon: image
                        });
                    }

                    marker = addMarkerToMap(LatLng);
                    var infoWindow = addInfoWindow(marker, currentName, currentNotes, points[currentPoint].Photo);
                    if (prevInfoWindow) {
                        prevInfoWindow.close();
                    }
                    prevInfoWindow = infoWindow;
                    prevMarker = marker;

                }, SPEED * ADDMARKER_MS);

                // recurse to the next point
                play(currentPoint + 1);

            }, getNextTime());

            function getNextTime() {
                // this is so we start instantly for the first point
                if (currentPoint == 0) {
                    return 1;
                }
                return SPEED * NEXT_MS;
            }

        }


    }

    function addMarkerToMap(latLng) {
        var marker = new google.maps.Marker({
            map: map,
            position: latLng
            // TODO Do we want this animation ? I feel it's more distracting than useful
            //animation: google.maps.Animation.DROP
        });
        return marker;
    }

    function addInfoWindow(marker, name, notes, photo) {
        var infowindow = new google.maps.InfoWindow();
        
        var html = 
        '<div id="im"><img src="' +
        photo +
        '" style="transform: translate3d(0px, 0px, 0px); width: 200px"></div> <div>' +
         notes + 
         '</div>';

        infowindow.setContent(html);// + '</strong><br>' + notes);     
        infowindow.open(map, marker);
        return infowindow;
    }

    function bringPointIntoView(latLng) {
        map.panTo(latLng);
    }

    function panToBounds(latLngSW, latLngNE) {
        var bounds = new google.maps.LatLngBounds();
        bounds.extend(latLngSW);
        bounds.extend(latLngNE);

        //panToBounds does not change zoom level; fitBounds does
        map.panToBounds(bounds);
    }

    function setZoomToCoverPoints(distanceBetweenPoints) {

        // TODO this should be reconsidered, the distances and zoom levels seem arbitrary
        // we should have a better algorithm that minimizes the number of times we have to change the zoom
        var zoomLevel, defaultZoomLevel = 5;

        var currentZoomLevel = map.getZoom();

        if (distanceBetweenPoints > 2500) {
            zoomLevel = defaultZoomLevel - 1;
        }
        else {
            zoomLevel = defaultZoomLevel;
        }

        // don't let zoomLevel reach 1
        if (zoomLevel <= 1) {
            zoomLevel = 2;
        }

        console.log("Set zoom level: " + zoomLevel + " Distance: " + distanceBetweenPoints);
        map.setZoom(zoomLevel);
        var zoomOut = false;

        if (zoomLevel < currentZoomLevel) {
            zoomOut = true;
        }

        var zoomArr = [];
        for (var i = 0; i < Math.abs(zoomLevel - currentZoomLevel); i++) {
            if (zoomOut) {
                zoomArr.push(currentZoomLevel - i + 1);
            } else {
                zoomArr.push(currentZoomLevel + i + 1);
            }
        }

    }

    function getDistanceBetweenPoints(lat1, lon1, lat2, lon2) {
        var radlat1 = Math.PI * lat1 / 180;
        var radlat2 = Math.PI * lat2 / 180;
        var radlon1 = Math.PI * lon1 / 180;
        var radlon2 = Math.PI * lon2 / 180;
        var theta = lon1 - lon2;
        var radtheta = Math.PI * theta / 180;
        var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
        dist = Math.acos(dist);
        dist = dist * 180 / Math.PI;
        dist = dist * 60 * 1.1515;
        dist = dist * 1.609344;
        dist = Math.round(dist * 1000) / 1000
        return dist
    }


}